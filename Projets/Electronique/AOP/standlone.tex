
%#############################################################
%MAIN file for  project
%#############################################################
\documentclass[12pt]{report}
%############################################################
%###### Package 'name' 
%###### This package contains ...
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{lmodern}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}     %UTF-8 encoding
\RequirePackage[many]{tcolorbox}
%1 : txt color
%2 : bg color 
%3 : text
\newtcbox{\badge}[3][red]{
  on line, 
  arc=2pt,
  colback=#3,
  colframe=#3,
  fontupper=\color{#2},
  boxrule=1pt, 
  boxsep=0pt,
  left=6pt,
  right=6pt,
  top=2pt,
  bottom=2pt
}

%################################################################%############################################################
%###### Package 'Chapter_1' 
%###### This package contains first model of chapter
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
% \RequirePackage[explicit]{titlesec} 


% \titleformat{\chapter}
%   {\gdef\chapterlabel{}
%    \normalfont\sffamily\Huge\bfseries\scshape}
%   {\gdef\chapterlabel{\thechapter)\ }}{0pt}
%   {\begin{tikzpicture}[remember picture,overlay]
%     \node[yshift=-2cm] at (current page.north west)
%       {\begin{tikzpicture}[remember picture, overlay]
%         \draw[fill=MediumBlue] (0,0) rectangle
%           (\paperwidth,2cm);
%         \node[anchor=east,xshift=.9\paperwidth,rectangle,
%               rounded corners=20pt,inner sep=11pt,
%               fill=white]
%               {\color{black}#1};%\chapterlabel
%           \node[anchor=west,yshift=1cm,xshift=2cm,inner sep=11pt,
%               fill=MediumBlue]
%               {\color{white}{\large Synthèse Latex}};%\chapterlabel
%        \end{tikzpicture}
%       };
%    \end{tikzpicture}
%   }
%   \titlespacing*{\chapter}{0pt}{50pt}{-60pt}%############################################################
%###### Package 'Color' 
%###### This package contains some colors
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{color}              %colors
%################################################################
\definecolor{pathColor}{rgb}{0.858, 0.188, 0.478}
\definecolor{fileColor}{rgb}{0.858, 0.188, 0.478}
\definecolor{water}{rgb}{0.858, 0.188, 0.478}
\definecolor{LightBlue}{RGB}{66, 163, 251}
\definecolor{DarkBlue}{RGB}{36, 100, 176}
\definecolor{LightGray}{gray}{.94}
\definecolor{DarkGray}{gray}{.172}
\definecolor{Orange}{RGB}{229, 133, 3}
\definecolor{MediumBlue}{RGB}{38, 119, 193}


\newcommand{\colors}[2]{
{\color{#1}{#2}}
}%############################################################
%###### Package 'Check' 
%###### This package contains soem tools to check data
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
%################################################################

  \makeatletter%
  \@ifpackageloaded{babel}
    {\typeout{>>> Utils : Babel package is loaded}}%
    {\typeout{>>> Utils : Babel package is not loaded}}%
  \makeatother%%############################################################
%###### Package 'Electronic' 
%###### This package contains some tools to generate electornic circuits
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################

\RequirePackage{tikz-timing}

\RequirePackage{graphics} %include figures
\RequirePackage{graphicx} %include figures
\RequirePackage{pgf,tikz}
\RequirePackage{circuitikz}
\usetikzlibrary{babel}  %allow to use tikz library with babel

\RequirePackage{ifthen}    %use if then 
 

%############################ Settings ##############################
\tikzset{%
    timing/table/axis/.style={->,>=latex},
    timing/table/axis ticks/.style={},   
}

%Direction of some device such as resistor, led...
%1.5 is the minimum length of device according my runs
\newcommand{\Up}{0,1.5}
\newcommand{\Down}{0,-1.5}
\newcommand{\Right}{1.5,0}
\newcommand{\Left}{-1.5,0}


%###### Length of components
\newcommand{\bipolesLength}[1]{#1cm}     %begin default size
%Length update
\newcommand{\setBipolesLength}[1]{
    \renewcommand{\bipolesLength}{#1}
    \ctikzset{bipoles/length=\bipolesLength cm}
}%End \setBipolesLength

%############ Mirrors and inverting
\newcommand{\Mirror}{}
\newcommand{\Invert}{}

%Update
\newcommand{\setMirror}[1]{
    \renewcommand{\Mirror}{,mirror}
}%End \setMirror

\newcommand{\setNoMirror}[1]{
    \renewcommand{\Mirror}{}
}%End \setMirror

\newcommand{\setInvert}[1]{
    \renewcommand{\Invert}{,Invert}
}%End \setInvert

\newcommand{\setNoInvert}[1]{
    \renewcommand{\Invert}{}
}%End \setInvert


%############## Rotate ###########
\newcommand{\rotate}{0}

%Update
\newcommand{\setRotate}[1]{
    \renewcommand{\rotate}{#1}
}%End \setRotate


%####################### Colors
%default colors of border colors and background colors
\newcommand{\deviceBorderColor}{black}
\newcommand{\deviceBackgroundColor}{white}

%Update
\newcommand{\setDeviceBorderColor}[1]{
    \renewcommand{\deviceBorderColor}{#1}
    \renewcommand{\deviceBackgroundColor}{white} %reset bg color
}%End \setDeviceBorderColor

\newcommand{\setDeviceBackgroundColor}[1]{
    \renewcommand{\deviceBorderColor}{black} %reset bg color
    \renewcommand{\deviceBackgroundColor}{#1}
}%\setDeviceBackgroundColor

%Reset
\newcommand{\resetColors}{
    \renewcommand{\deviceBorderColor}{black} %reset border color
    \renewcommand{\deviceBackgroundColor}{white} %reset bg color
}
%####################################################################
%############## draw device #########################################

%rotation
%color
%anchor

%\ifthenelse{\equal{#1}{0}}{A.}{no A.}
%Init

\begin{comment}
    @begin
    @command \addLogicGate
    @des 
    Cette commande permet de dessiner une porte logique à double entrée. Pour dessinder une porte inverseuse, utiliser la commande \addNotGate
    @sed
    @input Coordonnées de la porte en (x,y) sans parenthèse
    @input Référence de la porte pour s'accrocher aux entrées et sorties
    @input Type de la porte [nand, nor, or, and, or, xor]
    @input Label de sortie (laisser vide si absence de label souhaité)
    @input Label de l'entrée 1 (laisser vide si absence de label souhaité)
    @input Label de l'entrée 2 (laisser vide si absence de label souhaité)
    @input Nom de la porte [NOR1, AND1...]
    @begin_example 
    \addLogicGate{5,5}{logicgate}{nand}{S}{A}{B}{L1}
    @end_example
    @end
    \end{comment}

\newcommand{\addLogicGate}[7] {
    %\Colors
    \raiseMessage{Adding logic gate device [type=#3]}
    \ifthenelse{\equal{\deviceBorderColor}  {black}}
    {\draw (#1)         node (#2) [rotate=\rotate,xshift=0cm,fill=\deviceBackgroundColor,#3 port] {#7}}%if equal to black
    {\draw (#1)         node (#2) [rotate=\rotate,xshift=0cm,color=\deviceBorderColor,#3 port] {#7}}

    (#2.out)  node      [anchor=south west, yshift=-0.3cm] {#4}
    (#2.in 1) node (A1)     [anchor=east,xshift=0cm,yshift=+0.3cm]       {#5}
    (#2.in 2) node (B1)     [anchor=east,xshift=0cm,yshift=+0.3cm]       {#6};
}


\newenvironment{schema}[1]
{
    \begin{center}
        \makeatletter
        \def\@captype{figure}
        \makeatother
        \newcommand{\TitleSchema}{#1}%use var to print title 
        %\shorthandoff{:;!?} %Compulsory if frenchb package is used (from babel)
        \raiseMessage{Creating new schema ['#1']}
        \begin{tikzpicture}
            %\setGraphic %command to display with frenchb babel
    }
    { 
        \end{tikzpicture}
   % \caption{\TitleSchema}
    \end{center}
}


\newenvironment{numeric}[1]
{
\begin{center}
    \makeatletter
    \def\@captype{figure}
    \makeatother
    \newcommand{\TitleNumeric}{#1}%use var to print title 
    \raiseMessage{Creating new chronogram ['#1']}
\begin{tikztimingtable}
}
{
\end{tikztimingtable}%
\caption{\TitleNumeric}
\end{center}
}


%cood
%name device
%type (npn, pnp)
%B
%C
%E
\newcommand{\addTransistor}[6] {

    \raiseMessage{Adding transistor device [type=#3]}
    \ifthenelse{\equal{\deviceBorderColor}  {black}}
    {\draw (#1)         node (#2) [xshift=0cm,fill=\deviceBackgroundColor,#3] {}}%if equal to black
    {\draw (#1)         node (#2) [xshift=0cm,color=\deviceBorderColor,#3] {}}

    (#2.B)  node      [anchor=south west, xshift=0cm, yshift=0cm] {#4} 
    (#2.C) node (A1)     [anchor=north,xshift=0.3cm,yshift=+0.1cm]       {#5}
    (#2.E) node (B1)     [anchor=south,xshift=0.3cm,yshift=0.1cm]       {#6};
}
%node 1
%node 2
%wire type
\newcommand{\addWire}[3] {
    \draw (#1) #3 (#2);
}%end addWire

\newcommand{\orthogonalWireA}{-|}
\newcommand{\orthogonalWireB}{|-}
\newcommand{\directWire}{--}

%coord
%label
%value
\newcommand{\addNode}[3] {
    \node (#2) at (#1) {#3};
}%end addWire


%posiition (x,y)
%color
%width in pt
\newcommand{\addPoint}[3] {
    \filldraw [#2] (#1) circle (#3pt);
}%end addWire

%posiition (x,y)
%name
%value
\newcommand{\addPower}[3] {
    \raiseMessage{Adding power device [name=#2, value=#3]}
    \draw (#1) node (#2) [vcc] {#3};
}%end addPower

%posiition (x,y)
%name
%value
\newcommand{\addGround}[3] {
    \draw (#1) node (#2) [ground] {#3};
}%end addGround

%posiition depart(x,y)
%orientation de départ
%position arrivée
\newcommand{\addResistor}[4] {
    \raiseMessage{Adding resistor device}
    \draw (#1) to[R,l=$R$] +(#2) #4 (#3);
}%end addResistor

%posiition depart(x,y)
%orientation de départ
%position arrivée
%type de liaison
%nom de la led
\newcommand{\addLed}[5] {
    \raiseMessage{Adding LED device [name=#5]}
    \ifthenelse{\equal{\deviceBorderColor}  {black}}
    {\draw (#1) to[leD,l_=#5,fill=\deviceBackgroundColor] +(#2) #4 (#3);}
    {\draw (#1) to[leD,l_=#5,color=\deviceBorderColor] +(#2) #4 (#3);}

    % {\draw (#1)         node (#2) [xshift=0cm,fill=\deviceBackgroundColor,#3] {}}%if equal to black
    % {\draw (#1)         node (#2) [xshift=0cm,color=\deviceBorderColor,#3] {}}

    %\draw (#1) to[leD,l_=#5] +(#2) #4 (#3);
}%end addResistor%############################################################
%###### Package 'Font' 
%###### This package contains some tools to set fonts
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{fontawesome}

   %############################################################
%###### Package 'Glossaries' 
%###### This package contains some tools to set glossaries
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage[xindy, acronym, nomain, toc]{glossaries}
%################################################################
\makeglossaries

\renewcommand{\glossary}[1]{%
\gls{#1}
}%############################################################
%###### Package 'Graphics' 
%###### This package contains some tools to create graphics 2D or 3D
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
%\ProvidesPackage{Utils}[2013/01/13 Utils Package]
%############################################################
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}     %UTF-8 encoding
\RequirePackage{csvsimple} 
\RequirePackage{tikz,pgfplots,pgf}  
\RequirePackage{version}            %use commented code

\RequirePackage{graphics} %include figures
\RequirePackage{graphicx} %include figures
\RequirePackage{caption}
\RequirePackage{subcaption} %Add
\RequirePackage{version}            %use commented code
\pgfplotsset{compat=1.7}
%###### Checking if babel is loaded
\makeatletter
\@ifpackageloaded{babel}
{% if the package was loaded
\newcommand{\setGraphic}{\shorthandoff{:;!?}} %Compulsory if frenchb package is used (from babel)
\frenchbsetup{StandardLists=true} %to include if using \RequirePackage[french]{babel} -> rounded list
}
{%else:
\newcommand{\setGraphic}{} %Compulsory if frenchb package is used (from babel)
}
\makeatother
%############################################################
%### WARNING : USE \shorthandoff{:;!?} before \begin{tikzpicture} 
%### environment
%############################################################
\begin{comment}
@begin
@env graphics
@des 
Cet environnement permet de tracer des courbes en 2D à partir de points, d'équations ou de fichier CSV
@sed
@input Largeur du graphique ]0;1] 
@input Hauteur du graphique ]0;1+] 
@input Valeur minimale en abscisse 
@input Valeur maximale en abscisse
@input Valeur minimale en ordonnée 
@input Valeur maximale en ordonnée
@input Légende de l'axe des abscisse
@input Légende de l'axe des ordonnées
@input Titre du graphique
@begin_example 
\begin{graphics}{0.8}{0.5}{0}{100}{-10}{10}{ve}{vs}{Titre}
\addPointsFromCSV{raw.csv}
\end{graphics}
@end_example
@end
\end{comment}

\newenvironment{graphicFigure}[9]
{
    \raiseMessage{Creating new graphic figure [title='#9']}
    \begin{center}
        \makeatletter
        \def\@captype{figure}
        \makeatother

        \newcommand{\TitleGraphic}{#9}%use var to print title 
        \begin{tikzpicture}
        \setGraphic %command to display with frenchb babel
    %\shorthandoff{:;!?} %Compulsory if frenchb package is used (from babel)
    \begin{axis}[width=#1\linewidth,height=#2\linewidth,xmin=#3,xmax=#4,  ymin=#5, ymax=#6, scale only axis,xlabel=#7,ylabel=#8] %grid=both
    }
    { 
    \end{axis}
        \end{tikzpicture}
        \captionof{figure}{\TitleGraphic}
    \end{center}
}


\newenvironment{graphic}[9]
{
    \raiseMessage{Creating new graphic [title='#9']}
    \newcommand{\TitleGraphic}{#9}%use var to print title 
        \begin{tikzpicture}
        \setGraphic %command to display with frenchb babel
    \begin{axis}[width=#1\linewidth,height=#2\linewidth,xmin=#3,xmax=#4,  ymin=#5, ymax=#6, scale only axis,xlabel=#7,ylabel=#8, title=#9] %grid=both
    }
    { 
    \end{axis}
        \end{tikzpicture}

}
    
%############################################################
\begin{comment}
@begin
@command plot
@des 
Cette commande permet de tracer des surfaces 3D
@sed
@input Iitre du graphique
@input Equation à deux variables (x et y)
@begin_example 
\plot{Titre}{x*x+y*5}
@end_example
@end
\end{comment}   
    
\newcommand{\plot}[2]{
    \raiseMessage{Creating new plot [title='#1']}
\begin{tikzpicture}
\setGraphic %command to display with frenchb babel
 \begin{axis}[title={#1}, xlabel=x, ylabel=y]
 \addplot3[surf,domain=0:360,samples=50]
 {#2};
 \end{axis}
 \end{tikzpicture}
 }
    
%############################################################
\begin{comment}
@begin
@command addPoints
@des 
Cette commande permet de tracer une courbe en passant une liste de coordonnées de points : (x1,y1)(x2,y2)(...)
Il faut que cette commande soit utilisées dans l'environnement \textbf{graphics}.
@sed
@input Couleur de la courbe
@input Liste des coordonnées des points. Chaque point est entre parenthèse et les coordonnées sont séparées par une virgule
@begin_example 
\addPoints{red}{(0,0)(5,0)(5,5)(10,5)(10,0)}
@end_example
@end
\end{comment}   

\newcommand{\addPoints}[2]{
    \addplot+[thick,mark=none, color=#1] coordinates{#2};
}

%############################################################
\begin{comment}
@begin
@command addTrace
@des 
Cette commande permet de tracer une courbe en passant une équation en fonction de x
Il faut que cette commande soit utilisées dans l'environnement \textbf{graphics}.
@sed
@input Couleur de la courbe
@input Début du domaine de définition
@input Fin du domaine de définition
@input Équation à tracer
@begin_example 
\addTrace{blue}{4}{8}{8x^2}
@end_example
@end
\end{comment}

\newcommand{\addTrace}[4]{
    \addplot [#1, domain=#2:#3, samples=400] {#4};
}

%############################################################
\begin{comment}
@begin
@command addPointsFromCSV
@des 
Cette commande permet de tracer une courbe en passant un fichier de données CSV (ou format TXT)
Il faut que cette commande soit utilisées dans l'environnement \textbf{graphics}.
@sed
@input Couleur de la courbe
@input délimitateur des données (comma=virgule, semicolon=point-vigule)
@input Fichier des données
@begin_example 
\addPointsFromCSV{blue}{semicolon}{raw.csv}
@end_example
@end
\end{comment}

\newcommand{\addPointsFromCSV}[3]{
    \IfFileExists{#3}{
    \addplot+[thick, mark=none, color=#1] table[mark=none,col sep=#2] {#3};
    \raiseMessage{File '#3' loaded !}
    }
    {\raiseError{[import failed]'#3' \stop}
    }
}

%############################################################
\begin{comment}
@begin
@command addLegend
@des 
Cette commande permet d'ajouter une légende au graphique
Il faut que cette commande soit utilisées dans l'environnement \textbf{graphics}.
@sed
@input Légendes de chaque courbe séparées par une virgule
@begin_example 
\addLegend{sig1, sig2, sig3}
@end_example
@end
\end{comment}

\newcommand{\addLegend}[1]{
    \legend{#1}
}

%############################################################%############################################################
%###### Package 'Layout' 
%###### This package contains some tools to set page layout or text
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{lmodern}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}     %UTF-8 encoding
\RequirePackage{graphicx}           %Images
\RequirePackage{caption}            %légende
\RequirePackage{textcomp}           %special characters
\RequirePackage{fancyhdr}           %headers & footers
\RequirePackage{lastpage}           %page counter

\RequirePackage{float}              %image floating
\RequirePackage{wrapfig}
\RequirePackage{subcaption}         %Subcaption

\RequirePackage{geometry}

%############################################################

\begin{comment}
@begin
@command \setHeader
@des 
Cette commande permet de créer une page de garde minimaliste
@sed
@input Titre du document
@input Auteur(s) - Les retours à la ligne se font en utilisant la commande \\
@input La date
@begin_example 
\setHeader{Titre}{Auteur 1 \\ Auteur 2}{XX/XX/XXXX}
@end_example
@end
\end{comment}

\newcommand{\setHeader}[3]{
\title{#1}
\author{#2}
\date{#3}
\maketitle
}






%###############################################################
\begin{comment}
@begin
@command \partImg
@des 
Cette commande permet de créer une page de partie avec une image
@sed
@input Titre de la partie
@input Source de l'image \\
@input Ratio
@begin_example 
\partImg{Partie}{Images/file.png}{0.2}
@end_example
@end
\end{comment}
\newcommand{\partImg}[3]{
    \part[#1]{#1 \\\vspace*{2cm} \makebox{\centering \includegraphics[width=#3\textwidth]{#2}}}
}


%###############################################################
\begin{comment}
@begin
@command \setHeaderImage
@des 
Cette commande permet de créer une page de garde avec une image centrée, un titre, sous titre en plus
@sed
@input Titre du document
@input Auteur(s) - Les retours à la ligne se font en utilisant la commande \\
@input La date
@begin_example 
\setHeaderImage{Titre}{Auteur 1 \\ Auteur 2}{XX/XX/XXXX}
@end_example
@end
\end{comment}

\newcommand{\setHeaderImage}[6]{
\begin{titlepage}
  \begin{sffamily}
  \begin{center}
    \includegraphics[scale=#2]{#1} \sn \sn
    \hfill
%\HRule \\[0.4cm]
\begin{center}
    {\Huge \textbf{#3}} \sn
    \textbf{#4}\sn \sn
\end{center}
\sn \sn
 #5 \sn
   \vfill
   {\large #6}
  \end{center}
  \end{sffamily}
\end{titlepage}
}


%### Définition du style de page 'classic' si report

\newcommand{\addPresentation}[6]{
\fancypagestyle{classic}{
    \rhead{#3}  
    \lhead{#1}
    \chead{#2}
    \rfoot{#6}  %Page courante / Nombre de page
    \cfoot{#5}
    \lfoot{#4}
}

\@ifclassloaded{report}{
\makeatletter
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
                      \thispagestyle{classic} %Thème 'classic'
                      \global\@topnum\z@
                      \@afterindentfalse
                      \secdef\@chapter\@schapter}
\makeatother
}%End renew chapter

\@ifclassloaded{book}{
\makeatletter
\renewcommand\chapter{\if@openright\cleardoublepage\else\clearpage\fi
                      \thispagestyle{classic} %Thème 'classic'
                      \global\@topnum\z@
                      \@afterindentfalse
                      \secdef\@chapter\@schapter}
\makeatother
}%End renew chapter

\pagestyle{classic}
}


\newcommand{\setRightHeader}[1]{\rhead{#1}}
\newcommand{\setCenterHeader}[1]{\chead{#1}}
\newcommand{\setLeftHeader}[1]{\lhead{#1}}

\newcommand{\setRightFooter}[1]{\rfoot{#1}}
\newcommand{\setCenterFooter}[1]{\cfoot{#1}}
\newcommand{\setLeftFooter}[1]{\lfoot{#1}}



\newcommand{\setHeaderLine}[1]{ 
\renewcommand{\headrulewidth}{#1pt} 
}
\newcommand{\setFooterLine}[1]{ 
\renewcommand{\footrulewidth}{#1pt} 
}
  
\newcommand{\currentChapter}{\leftmark}

%Raccourcis
\@ifclassloaded{report)}{

\newcommand{\setAliasChapter}[1]{
\makeatletter
\renewcommand{\@chapapp}{#1}   %Le mot 'Chapitre' est remplacé par 'Section'
\makeatother
}
}%End if
{
  \newcommand{\setAliasChapter}[1]{
}
}

\@ifclassloaded{book)}{
\newcommand{\currentChapter}{\leftmark}
\newcommand{\setAliasChapter}[1]{
\makeatletter
\renewcommand{\@chapapp}{#1}   %Le mot 'Chapitre' est remplacé par 'Section'
\makeatother
}
}%End if


\newcommand{\currentPage}{\thepage/\pageref{LastPage}}%############################################################
%###### Package 'name' 
%###### This package contains ...
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{lmodern}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}     %UTF-8 encoding
\RequirePackage{graphicx}           %Images
\RequirePackage{caption}            %légende
\RequirePackage{float}              %image floating
\RequirePackage{wrapfig}
\RequirePackage{subcaption}         %Subcaption

%################################################################


\newcounter{imgCounter}  %Number of img

%##################
\begin{comment}
    @begin
    @command \img
    @des 
    Cette commande permet de mettre une image centrée avec un titre et une taille
    @sed
    @input Source et nom de l'image
    @input Titre de l'image
    @input Taille de l'image ]0;1+]
    @begin_example 
    \img{Image.png}{Titre de l'image}{0.5}
    @end_example
    @end
\end{comment}
    
\newcommand{\img}[3]{\IfFileExists{#1}{\begin{figure}[H]\centering\ \includegraphics[scale=#3]{#1}\caption{#2}\end{figure} \addtocounter{imgCounter}{1} \raiseMessage{Image '#1' [size=#3,id \arabic{imgCounter}] loaded !}  }{\raiseWarning{Image '#1' no loaded}}}


\begin{comment}
      @begin
      @command \imgr
      @des 
      Cette commande permet de mettre une image centrée avec un titre et une taille et un angle
      @sed
      @input Source et nom de l'image
      @input Titre de l'image
      @input Taille de l'image ]0;1+]
      @input angle en degres
      @begin_example 
      \img{Image.png}{Titre de l'image}{0.5}{90}
      @end_example
      @end
\end{comment}
\newcommand{\imgr}[4]{\IfFileExists{#1}{\begin{figure}[H]\centering\ \includegraphics[scale=#3,angle=#4]{#1}\caption{#2}\end{figure} \addtocounter{imgCounter}{1} \raiseMessage{Image '#1' [size=#3,id \arabic{imgCounter},angle=#4] loaded !} }{\raiseWarning{Image '#1' no loaded}}}

    %################################################################
    \begin{comment}
    @begin
    @command \imgf
    @des 
    Cette commande permet de mettre une image centrée sans titre et une taille de manière flottante avec le contenu
    @sed
    @input Source et nom de l'image
    @input Titre de l'image
    @input Taille de l'image ]0;1+] par rapport au texte
    @input Taille de l'image par rapport à l'espace qui lui est reservé
    
    @begin_example 
    \img{Image.png}{Titre de l'image}{0.5}{0.5}
    @end_example
    @end
    \end{comment}
    



    %################################################################%############################################################
%###### Package 'Index' 
%###### This package contains some tools to set index
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
%################################################################
\RequirePackage{makeidx}            %make index

\makeindex%############################################################
%###### Package 'name' 
%###### This package contains ...
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{enumitem}
\RequirePackage{pifont}

%################################################################

\newcommand{\setTriangleList}{\renewcommand{\labelitemi}{$\blacktriangleright$}}
\newcommand{\setCircleList}{\renewcommand{\labelitemi}{$\circ$}}
\newcommand{\setBulletList}{\renewcommand{\labelitemi}{$\bullet$}}
\newcommand{\setDiamondList}{\renewcommand{\labelitemi}{$\diamond$}}

\newcommand{\Triangle}{$\blacktriangleright$}
\newcommand{\Circle}{$\circ$}
\newcommand{\Bullet}{$\bullet$}
%\newcommand{\Diamond}{$\diamond$}


\newenvironment{items}[2]
{      
        \begin{itemize}[font=\color{#1}, label=#2]  
    }
    { 
        \end{itemize}
}%############################################################
%###### Package 'name' 
%###### This package contains ...
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\tcbuselibrary{listings,breakable, skins}
%\RequirePackage{amsmath}

%################################################################

\newtcbox{\file}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=orange!50!black,coltext=orange!25!black,colback=orange!10!white,
  overlay={\begin{tcbclipinterior}\fill[orange!75!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {FILE} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}

\newtcbox{\lib}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=green!50!black,coltext=green!25!black,colback=green!10!white,
  overlay={\begin{tcbclipinterior}\fill[green!75!green!50!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {LIB} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}

\newtcbox{\dir}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=blue!50!black,coltext=blue!25!black,colback=blue!10!white,
  overlay={\begin{tcbclipinterior}\fill[blue!75!blue!50!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {DIR} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}


\newtcbox{\shortcut}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=purple!50!black,coltext=purple!25!black,colback=purple!10!white,
  overlay={\begin{tcbclipinterior}\fill[purple!75!blue!50!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {KEY} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}

\newtcbox{\link}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=purple!50!black,coltext=purple!25!black,colback=purple!10!white,
  overlay={\begin{tcbclipinterior}\fill[purple!75!blue!50!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {URL} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}


\newtcbox{\bin}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=blue!50!black,coltext=blue!25!black,colback=blue!10!white,
  overlay={\begin{tcbclipinterior}\fill[blue!75!blue!50!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {BIN} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}

\newtcbox{\hexa}{enhanced, nobeforeafter,tcbox raise base,boxrule=0.4pt,top=0mm,bottom=0mm,
  right=0mm,left=4mm,arc=1pt,boxsep=2pt,before upper={\vphantom{dlg}},
  colframe=blue!50!black,coltext=blue!25!black,colback=blue!10!white,
  overlay={\begin{tcbclipinterior}\fill[blue!75!blue!50!white] (frame.south west)
    rectangle node[text=white,font=\sffamily\bfseries\tiny,rotate=90] {HEX} ([xshift=4mm]frame.north west);\end{tcbclipinterior}}}



\newtcbox{\ugrey}{nobeforeafter,colframe=gray,colback=gray!10!white,boxrule=0.5pt,arc=2pt,
  boxsep=0pt,left=2pt,right=2pt,top=2pt,bottom=2pt,tcbox raise base}


\newtcbox{\ugreen}{nobeforeafter,colframe=white,colback=green!40!white,boxrule=0pt,arc=0pt,
  boxsep=0pt,left=1pt,right=1pt,top=1pt,bottom=1pt,tcbox raise base}

\newtcbox{\ublue}{nobeforeafter,colframe=white,colback=blue!10!white,boxrule=0pt,arc=0pt,
  boxsep=0pt,left=1pt,right=1pt,top=1pt,bottom=1pt,tcbox raise base}

\newtcbox{\uorange}{nobeforeafter,colframe=white,colback=orange!40!white,boxrule=0pt,arc=0pt,
  boxsep=0pt,left=1pt,right=1pt,top=1pt,bottom=1pt,tcbox raise base}

\newtcbox{\ured}{nobeforeafter,colframe=white,colback=orange!40!red,boxrule=0pt,arc=0pt,
  boxsep=0pt,left=1pt,right=1pt,top=1pt,bottom=1pt,tcbox raise base}

\newtcbox{\highlight}[1]{nobeforeafter,colframe=white,colback=#1,boxrule=0pt,arc=0pt,
  boxsep=0pt,left=1pt,right=1pt,top=1pt,bottom=1pt,tcbox raise base}%############################################################
%###### Package 'Layout' 
%###### This package contains some tools to set page layout or text
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{lmodern}
\RequirePackage[T1]{fontenc}
\RequirePackage[utf8]{inputenc}     %UTF-8 encoding

\RequirePackage{xcolor}             %define new colors
\RequirePackage{xparse}
\RequirePackage{amssymb,amsthm}     %math


%################################################################
\begin{comment}
@begin
@command \bold
@des 
Cette commande permet de mettre le texte en gras
@sed
@input Texte à mettre en gras
@begin_example 
\bold{texte en gras}
@end_example
@end
\end{comment}

\renewcommand{\bold}[1]{\textbf{#1}}

%################################################################
\begin{comment}
@begin
@command \italic
@des 
Cette commande permet de mettre le texte en italique
@sed
@input Texte à mettre en italique
@begin_example 
\italic{texte en italique}
@end_example
@end
\end{comment}

\newcommand{\italic}[1]{\textit{#1}}

%################################################################
\begin{comment}
@begin
@command \ib
@des 
Cette commande permet de mettre le texte en italique et en gras
@sed
@input Texte à mettre en italique et gras
@begin_example 
\ib{texte en italique et gras}
@end_example
@end
\end{comment}

\newcommand{\ib}[1]{\textit{\textbf{#1}}}

%################################################################
\begin{comment}
@begin
@command \bi
@des 
Cette commande permet de mettre le texte en italique et en gras
@sed
@input Texte à mettre en italique et gras
@begin_example 
\bi{texte en italique et gras}
@end_example
@end
\end{comment}

\newcommand{\bi}[1]{\textit{\textbf{#1}}}


\begin{comment}
@begin
@command \n
@des 
Cette commande permet de faire un saut de ligne
@sed
@begin_example 
Text \n Next text
@end_example
@end
\end{comment}

\newcommand{\n}{\\}

%################################################################
\begin{comment}
@begin
@command \sn
@des 
Cette commande permet de faire un espace vertical
@sed
@begin_example 
Text \sn Next text
@end_example
@end
\end{comment}

\newcommand{\sn}{\vskip 0.5cm}

%################################################################

%#######################################%############################################################
%###### Package 'name' 
%###### This package contains tools to use links, url and other
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{hyperref}           %Url

%################################################################
\begin{comment}
@begin
@command \setParameters
@des 
Cette commande permet de définir les propriétés du document PDF (auteur, titre...)
@sed
@input Titre du PDF
@input Auteur(s)
@input Sujet du fichier PDF (courte phrase)
@input Créateur du fichier PDF
@input Mots-clés (liste)
@input Couleurs des liens
@input Couleurs des citations dans la bibliographie
@input Couleurs des liens de fichier
@input Couleurs des liens externe
@begin_example 
\setParameters {Tutoriel Latex} {Nicolas LE GUERROUE} {Tutoriel Latex pour la mise en place des outils} {\author}{Latex}{green}{blue}{blue}
@end_example
@end
\end{comment}

\newcommand{\setParameters}[8]{
   \typeout{>>> Utils - [MData] : title='#1}
   \typeout{>>> Utils - [MData] : author(s)='#2'}
   \typeout{>>> Utils - [MData] : subject='#3'}
   \typeout{>>> Utils - [MData] : creator='#4'}
   \typeout{>>> Utils - [MData] : keywords='#5'}
   \typeout{>>> Utils - [MData] : link colors='#6'}
   \typeout{>>> Utils - [MData] : bib links colors='#7'}
   \typeout{>>> Utils - [MData] : link file colors='#8'}
\hypersetup{
    bookmarks=true,         % show bookmarks bar?
    unicode=true,          % non-Latin characters in Acrobat’s bookmarks
    pdftoolbar=true,        % show Acrobat’s toolbar?
    pdfmenubar=true,        % show Acrobat’s menu?
    pdffitwindow=false,     % window fit to page when opened
    pdfstartview={1},    % fits the width of the page to the window
    pdftitle={#1},    % title
    pdfauthor={#2},     % author
    pdfsubject={#3},   % subject of the document
    pdfcreator={#4},   % creator of the document
    pdfproducer={#4}, % producer of the document
    pdfkeywords={#5}, % list of keywords
    pdfnewwindow=true,      % links in new PDF window
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=black,          % color of internal links (change box color with linkbordercolor)
    citecolor=#6,        % color of links to bibliography
    filecolor=#7,         % color of file links
    urlcolor=#8        % color of external links
} }%############################################################
%###### Package 'Maths' 
%###### This package contains some tools to set mathematic tools
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
%Vecteur à 3 composantes  
\newcommand{\evec}[3]{\left (\begin{array}{ccc} #1 \\ #2 \\ #3\end{array} \right )}
%Matrice à 3 composantes
\newcommand{\emat}[3]{\left [\begin{array}{ccc} #1 \\ #2 \\ #3\end{array} \right ]}
% \emat{a & b & c}{d & e & f}{g & h & i}%############################################################
%###### Package 'MessageBox' 
%###### This package contains some tools to set messageBox
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage[many]{tcolorbox}
\RequirePackage{color}              %colors
\RequirePackage{geometry}
%################################################################
\newcounter{messageBoxCounter}  %Number of msgBox
%###############################################################

\newcommand{\messageBox}[5]{
% 1: title
% 2: color frame
% 3: color bg
% 4: content
% 5: titlecolor
%\messageBox{Remarque}{green}{white}{Erreur 0xff58}{black}
%\messageBox{Installation}{gray}{white}{DE}{black}
%\messageBox{Avertissement}{orange}{white}{dede}{black}
%\messageBox{Erreur}{red}{white}{dede}{black}
\addtocounter{messageBoxCounter}{1}
\raiseMessage{MessageBox '#1' [id \arabic{messageBoxCounter}] created !}
 \begin{tcolorbox}[title=#1,
colframe=#2!80,
colback=#3!10,
coltitle=#5!100,  
]
#4
\end{tcolorbox}
}%############################################################
%###### Package 'Glossaries' 
%###### This package contains some tools to set glossaries
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{nomencl}  %nomenclature
%################################################################


\makenomenclature

%##### Convention [Nomenclature]
  \renewcommand{\nomgroup}[1]{%
  \item[\bfseries
  \ifthenelse{\equal{#1}{P}}{Constantes physiques}{%
  \ifthenelse{\equal{#1}{O}}{Autres symboles}{%
  \ifthenelse{\equal{#1}{N}}{Nombres spéciaux}{ 
  \ifthenelse{\equal{#1}{A}}{Amplificateurs Opérationnels}{ 
  \ifthenelse{\equal{#1}{M}}{Mécanique}{ 
  \ifthenelse{\equal{#1}{E}}{Électronique}{}}}}}}%
  ]}


  % Add unit on convention [nomenclature]
%----------------------------------------------
\newcommand{\addUnit}[1]{%
\renewcommand{\nomentryend}{\hspace*{\fill}#1}}
%----------------------------------------------%############################################################
%###### Package 'Titles' 
%###### This package contains some tools to set title color
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{pdfpages} 
%################################################################

%\includepdf[⟨options⟩]{⟨fichier⟩}\RequirePackage{color}              %colors
\RequirePackage{listings}           %new env such as Bash, Python
\RequirePackage{xcolor}             %define new colors
\RequirePackage{graphicx}             %define new colors
\RequirePackage{xparse}
\RequirePackage{amssymb,amsthm}     %math
\RequirePackage{multirow}
\RequirePackage{tabularx}           %use for csv file [table]
\RequirePackage{textcomp}           %special characters

%###############################################################
%### Couleurs programmation
\definecolor{green}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{purple}{rgb}{0.58,0,0.82}
\definecolor{bg}{rgb}{0.98,0.98,0.98}
%###############################################################
%### définition du style 'Python' [begin{Python}]
\lstdefinestyle{Python}{
    backgroundcolor=\color{bg},   
    commentstyle=\color{green},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{gray},
    stringstyle=\color{purple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=none,   %left, right, none 
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,  
    tabsize=2
}
\lstset{style=Python}
\lstset{literate=
  {á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
  {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1 {Ú}{{\'U}}1
  {à}{{\`a}}1 {è}{{\`e}}1 {ì}{{\`i}}1 {ò}{{\`o}}1 {ù}{{\`u}}1
  {À}{{\`A}}1 {È}{{\'E}}1 {Ì}{{\`I}}1 {Ò}{{\`O}}1 {Ù}{{\`U}}1
  {ä}{{\"a}}1 {ë}{{\"e}}1 {ï}{{\"i}}1 {ö}{{\"o}}1 {ü}{{\"u}}1
  {Ä}{{\"A}}1 {Ë}{{\"E}}1 {Ï}{{\"I}}1 {Ö}{{\"O}}1 {Ü}{{\"U}}1
  {â}{{\^a}}1 {ê}{{\^e}}1 {î}{{\^i}}1 {ô}{{\^o}}1 {û}{{\^u}}1
  {Â}{{\^A}}1 {Ê}{{\^E}}1 {Î}{{\^I}}1 {Ô}{{\^O}}1 {Û}{{\^U}}1
  {Ã}{{\~A}}1 {ã}{{\~a}}1 {Õ}{{\~O}}1 {õ}{{\~o}}1 {’}{{'}}1
  {œ}{{\oe}}1 {Œ}{{\OE}}1 {æ}{{\ae}}1 {Æ}{{\AE}}1 {ß}{{\ss}}1
  {ű}{{\H{u}}}1 {Ű}{{\H{U}}}1 {ő}{{\H{o}}}1 {Ő}{{\H{O}}}1
  {ç}{{\c c}}1 {Ç}{{\c C}}1 {ø}{{\o}}1 {å}{{\r a}}1 {Å}{{\r A}}1
  {€}{{\euro}}1 {£}{{\pounds}}1 {«}{{\guillemotleft}}1
  {»}{{\guillemotright}}1 {ñ}{{\~n}}1 {Ñ}{{\~N}}1 {¿}{{?`}}1
}
\lstnewenvironment{Python}[1]{\lstset{language=Python, title=#1}}{}
%###############################################################
%###############################################################
%### définition du style 'Cpp' [begin{Cpp}]
\lstdefinestyle{Cpp}{
    basicstyle=\ttfamily,
    columns=fullflexible,
    keepspaces=true,
    upquote=true,
    showstringspaces=false,
    commentstyle=\color{olive},
    keywordstyle=\color{blue},
    identifierstyle=\color{violet},
    stringstyle=\color{purple},
    numbers=none,
    language=c,
}
\lstnewenvironment{Cpp}[1]{\lstset{style=Cpp, title=#1}}{}

%###############################################################
%### définition du style 'Bash' [begin{Bash}]
\lstdefinestyle{Bash}{
    basicstyle=\ttfamily,
    columns=fullflexible,
    keepspaces=true,
    upquote=true,
    frame=trBL, %frame=trBL, shadowbox, trrb
    %frameround=fttt,
    numbers=none,
    showstringspaces=false,
    commentstyle=\color{olive},
    keywordstyle=\color{blue},
    identifierstyle=\color{black},
    stringstyle=\color{gray},
    language=bash,
    morekeywords={sudo,apt-get,install, autoremove, update, upgrade}
}
\lstnewenvironment{Bash}[1]{\lstset{style=Bash, title=#1}}{}%############################################################
%###### Package 'Theorems' 
%###### This package contains some tools to set theorems
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage{amssymb,amsthm}     %math
%################################################################
%###############################################################
\newtheorem{question}{Question}
\newtheorem{reponse}{$>>>$}
\newtheorem{propriete}{Propriété}
\newtheorem{proposition}{Proposition}
\newtheorem{remarque}{Remarque}
\newtheorem{exemple}{Exemple}
\newtheorem{definition}{Definition}%############################################################
%###### Package 'Titles' 
%###### This package contains some tools to set title color
%###### Author  : Nicolas LE GUERROUE
%###### Contact : nicolasleguerroue@gmail.com
%############################################################
\RequirePackage[explicit]{titlesec} 
%################################################################

% \@ifclassloaded{report}{
%     \titleformat{\chapter}[display] {\fontsize{17pt}{12pt}\selectfont \bfseries}{\textcolor{blue} {\chaptertitlename\ \thechapter: #1}}{20pt}{\Huge}
% }

\titleformat{\section}[display] {\fontsize{17pt}{12pt}\selectfont \bfseries}{\textcolor{DarkBlue} {#1}}{20pt}{\Huge}
\titleformat{\subsection}[display] {\fontsize{15pt}{12pt}\selectfont \bfseries}{\textcolor{orange} {#1}}{20pt}{\large}
\titlespacing*{\section}{0pt}{20pt}{-30pt}
\titlespacing*{\subsection}{0pt}{20pt}{-20pt}
\documentclass[12pt]{report}  
%book, report, beamer, article
\usepackage[frenchb]{babel}     %french language
\usepackage{Utils/Utils}        %Utils package

%\usepackage[Lenny]{fncychap}   %Sonny, Lenny, Glenn, Conny, Rejne, Bjarne
%#############################################################
%#### Settings
%#############################################################
%#############################################################
%If you want to set on fullpage, change this bloc
%#############################################################
\geometry{hmargin=2.5cm,vmargin=2.5cm}
%#############################################################
%#############################################################
%If you want rename the chapter name, change the value of argument
%#############################################################
\setAliasChapter{Section}
%#############################################################
%#############################################################
%If you want to add presentation, modify the next bloc
%The firt line is about the header : 
% {left content}{center content}{right content}
%The second line is about the footer : 
% {left content}{center content}{right content}
%####
%to get the current chapter name, use \currentChapter command as content
%to get the current number page, use \currentPagecommand as content
\addPresentation
{} {} {}
{Club de Robotique et d'Electronique\\ Programmable de Ploemeur} {} {\currentPage}
%#############################################################
%Change the width of footer line and header line
%To delete it, set value to 0
\setHeaderLine{0}
\setFooterLine{0.2}

%#############################################################
%Change the name of the section "Nomenclature"
%To delete it, set value to 0
\renewcommand{\nomname}{Conventions}
%Setting up the parameter of PDF file as name, author...
\begin{comment}
@input Titre du PDF
@input Auteur(s)
@input Sujet du fichier PDF (courte phrase)
@input Créateur du fichier PDF
@input Producteur du fichier PDF
@input Mots-clés (liste)
@input Couleurs des liens
@input Couleurs des citations dans la bibliographie
@input Couleurs des liens de fichier
\end{comment}
\setParameters {Les Circuits de puissance} {Nicolas LE GUERROUE} {Transistors, MOSFETS, Bipolaires, relais} {Nicolas LE GUERROUÉ}{Circuits de puissance}{green}{blue}{blue}
  

\addtocounter{tocdepth}{1}



\titleformat{\chapter}
  {\gdef\chapterlabel{}
   \normalfont\sffamily\Huge\bfseries\scshape}
  {\gdef\chapterlabel{\thechapter)\ }}{0pt}
  {\begin{tikzpicture}[remember picture,overlay]
    \node[yshift=-2cm] at (current page.north west)
      {\begin{tikzpicture}[remember picture, overlay]
        \draw[fill=MediumBlue] (0,0) rectangle
          (\paperwidth,2cm);
        \node[anchor=east,xshift=.9\paperwidth,rectangle,
              rounded corners=20pt,inner sep=11pt,
              fill=white]
              {\color{black}#1};%\chapterlabel
          \node[anchor=west,yshift=1cm,xshift=2cm,inner sep=11pt,
              fill=MediumBlue]
              {\color{white}{\large AOP}};%\chapterlabel
       \end{tikzpicture}
      };
   \end{tikzpicture}
  }
  \titlespacing*{\chapter}{0pt}{50pt}{-60pt}
\begin{document}
\setHeader{A}{A}{A}
\tableofcontents
\setcounter{page}{2}

 \chapter{Introduction }
 
 \section{Généralités}

  
Un AOP (Amplificateur Opérationnel) est un composant actif qui permet de réaliser des opérations mathématiques (addition, soustraction, intégration, dérivation, etc) et du fait de sa miniaturisation et de sa fiabilité, on le rencontre aujourd’hui dans de nombreuses applications comme l’audio, la radio, l’asservissement…

\img{\rootImages/pinout.png}{Les entrées et sorties de l'AOP}{0.5}

Un AOP possède deux entrées notées appelées {\color{red}entrée non inverseuse} et {\color{red}entrée inverseuse}, une {\color{red}sortie} et deux broches d’{\color{red}alimentation}.
L’AOP dispose souvent d’une alimentation symétrique ($Vcc+$ et $Vcc-$) avec comme référence de tension le point milieu (GND) des alimentations.

\img{\rootImages/power.png}{L'alimentation d'un AOP}{0.6}


\section{Conventions}


Afin de simplifier les calculs sur les AOP, quelques conventions ont été adoptées :

\begin{itemize}
  \item La tension de sortie de l’AOP est notée $Vs$
  \item La tension sur l’entrée inverseuse est appelée $E_-$
  \item La tension sur l’entrée non inverseuse est appelée $E_+$
  \item La tension différentielle {\color{red}$(E+-E-)$ est appelée $\varepsilon$}
  \item Le gain d’amplification différentiel de l’AOP est appelé $Ad$
  Ce gain est variable entre différentes familles d’AOP mais reste constant dans le temps
  \item Le gain d’amplification du montage est appelé $A_0$ et varie en fonction des différents montages possibles 
\end{itemize}

\messageBox{Remarque}{green}{white}{L’alimentation des montages suivants ne sera pas représenté par souci de clarté.}{black}
\chapter{Modélisation de l'AOP}
\section{Modèle théorique}

Dans un souci de simplification des calculs, un AOP peut être vu physiquement comme un composant ayant des caractéristiques parfaites. Ces caractéristiques sont les suivantes :

\begin{itemize}
  \item impédance d’entrée :  $Z\rightarrow+\infty \Omega$
  \item Impédance de sortie : $Z=0 \Omega$ 
  \item $Ad\rightarrow+\infty$
  \item Vsmax $ = Vcc_+$
  \item Vsmin $ = Vcc_-$
  \item Bande passante : $Fmax\rightarrow+\infty$
\end{itemize}

Cela se traduit par un modèle dont les deux entrées sont ouvertes (courant nul) et avec une tension de sortie qui ne serait pas affectée par le courant de sortie

\img{\rootImages/theorique.png}{Le modèle théorique de l'AOP}{0.6}

\section{Modèle réel} 


Cependant, il convient de noter que ce modèle n’est que théorique.\\

Du fait de la nature des composants constituant les AOP (transistors, condensateurs), la tension de sortie ne peut pas être égale à la tension d’alimentation. 

Cette tension de sortie max est appelée $Vsat_+$et $Vsat_-$ \\

D'où le modèle suivant : 

\begin{itemize}
  \item impédance d’entrée :  $Z>10^5 \Omega$
  \item Impédance de sortie : $Z>0 \Omega$ (courant de sortie max $20mA$)
  \item $Ad \gg 1000$
  \item $Vs_{max}$ =$Vcc_{sat_+}$
  \item $Vs_{min}$ =$Vcc_{sat_-}-$
  \item Bande passante : imposée par le constructeur (Ex : le LM324 tolère 1MHz)
\end{itemize}


\img{\rootImages/real.png}{Le modèle réel de l'AOP}{0.6}


Cependant, pour les calculs, {\color{red}l’hypothèse du courant d’entrée} nul sera retenue, tout comme celle du gain $Ad$


\section{ Modes de fonctionnement}


\subsection{Montages linéaires }
Le signal $V_s$ est une fonction mathématique du signal d’entrée $V_e$. \\

Dans certains cas, le signal de sortie conserve la forme du signal d’entrée sous couvert que que l’AOP ne rentre pas en saturation. \\


Un {\color{red}montage linéaire impose un $\varepsilon$ nul, sauf si l’AOP est saturé}, c’est à dire si $V_s=V_{sat}$




\subsection{Montages comparateurs}

Le signal de sortie ne peut prendre que deux valeurs, $Vsat_+$ou $Vsat_-$
En l’absence de contre-réaction, $Vs=\varepsilon Ad$ \\

\bold{Une réaction est un retour du signal sur une des deux entrées. Celle ci peut être positive ou négative en fonction de l’entrée choisie (entrée -,réaction négative et entrée +, réaction positive).}

\img{\rootImages/52.png}{Les modes de fonctionnement de l'AOP}{0.6}

\section{Résistance de charge}

Il est possible de mettre une résistance de charge entre $V_s$ et la masse. \\

Cette résistance symbolise un circuit relié directement à l'AOP. \\

Cependant, le courant de l’AOP étant limité à quelques dizaines de mA, il convient de prendre une résistance de charge $R_c$ suffisamment grande ($Rc>1000 \omega$). \\

Si $R_{c}$ est suffisamment élevée, cette dernière n’influence pas la tension de sortie $V_s$ \\


\img{\rootImages/load.png}{La résistance de charge}{0.8}

\chapter{Étude en mode linéaire}
\section{Intérêt de l’étude }

Les AOP en fonctionnement linéaire permettent de réaliser les opérations mathématiques :

\begin{itemize}
  \item \bold{amplification} : $Vs=A_0 \cdot Ve$
  $A_0$ est le coefficient d’amplification du montage (A ne pas confondre avec $A_d$ le coefficient d’amplification différentiel imposé par le constructeur)
  $A_0$ peut être positif ou négatif
  \item \bold{addition algébrique} : $V_s=\sum_{k=0}^{n} V_k$
  \item \bold{intégration et dérivation} (avec des condensateurs) à une constante près
  \item \bold{logarithme et exponentielle}
\end{itemize}

\section{Méthode de résolution}
La {\color{red}réaction négative} (liaison entre la sortie et l’entrée inverseuse) impose un fonctionnement stable et linéaire, d'où {\color{red}$\varepsilon=0, E_+=E_-$} \\

L’hypothèse de la résistance d’entrée de l’AOP implique que $I_+=I_-=0$

Afin de déterminer $Vs$, il faut exprimer \bold{$E_+$et $E_-$ en fonction des éléments du montage}. \\

\bold{En égalisant les deux équations obtenues ($E_+=k$ et $E_-=k'$)}, on obtient une relation de type $V_s = f(V_e)$


\messageBox{Remarque}{orange}{white}{$I_s$ est issu d’une source de tension, il n’y a donc pas de loi simple permettant de déterminer sa valeur algébrique. Il ne faut pas avoir d'à priori sur son sens}{black}


 \part{Montages}
\chapter{Montage suiveur }


\section{Présentation}


Ce montage permet de reproduire à l’identique une tension d'entrée. \\
L'intérêt de ce montage réside dans le fait que l’impédance d’entrée de l’AOP est considérée comme infinie et que son impédance de sortie est considérée comme nulle.\\

Ainsi, le comportement de la charge en entrée ne sera pas affecté par l’AOP, le signal d'entrée ne sera donc pas modifié. \\

Ce montage sert donc à faire une \bold{adaptation d’impédance}.

\section{Montage}

\img{\rootImages/suiveur.png}{Le montage suiveur}{0.6}


\section{Démonstration} 
La réaction négative implique que $\varepsilon=0$ (fonctionnement linéaire)
$$ E_+=Ve $$
$$ E_-=Vs $$

$$ \Rightarrow Ve=Vs$$ car $E_+=E_-$


%\section{Application}

\begin{exemple}
On souhaite mesurer une tension au borne d’un capteur avec un appareil de mesure.

\img{\rootImages/sensor.png}{Le capteur}{0.6}

On place ensuite une charge $R_c$ au bornes de $A$ et $b$. Cette résistance $R_c$ représente l'appareil d'acquisition.

\img{\rootImages/rc.png}{Le modèle d'acquisition}{0.3}
\end{exemple}

\begin{question}
Quelle est l’influence de $Rc$ sur $U_{AB}$ dans le montage suivant ?
\end{question}

\begin{reponse}

Sans la charge $Rc$ : 

$$ U_{AB}= \frac{U \cdot R_2}{R_1+R_2}$$

Avec  la charge $Rc$ :

$$ U_{AB}= \frac{U \cdot R_{equ}}{R_1+R_{equ}}$$


Avec $R_{equ}$ la résistance équivalente entre $R_2$ et $R_c$ \\



Si $R_c \rightarrow + \infty$ alors $R_{equ} \rightarrow \frac{U_{AB} \cdot R_2}{R_1+R_2}$ \\

Si $R_c \rightarrow + 0 $ alors $R_{equ} \rightarrow 0 \Rightarrow U_{AB} \rightarrow 0$

\end{reponse}


D'où le montage suivant, avec $R_c \rightarrow + \infty$, le signal n'est pas déformé.


\img{\rootImages/measure.png}{L'adaptation d'impédance}{0.8}


\chapter{Montage non-inverseur}


\section{Présentation}

Ce montage amplifie la tension $V_e$ par un \bold{gain $A_0$ positif}. \\
L’amplificateur reste en mode linéaire si $Ve < Vcc_{sat} \cdot A_0$

\section{Montage}

\img{\rootImages/non_inv.png}{Le montage amplificateur non inverseur}{0.8}

\section{Démonstration}

Un AOP en mode linéaire impose $\varepsilon=0$
D'où $E_+ =E_-$ 

$$E_+=V_e$$
$$E_-=V_s \cdot \frac{R_2}{R_1+R_2}$$

\begin{align}
E_+ = E_- &\Rightarrow V_e = V_s \cdot \frac{R_2}{R_1+R_2}\\
 &\Rightarrow \frac{V_e}{V_s} = \frac{R_2}{R_1+R_2}\\
 &\Rightarrow V_s = V_e \cdot \frac{R_1+R_2}{R_2} \\
\end{align}

%avec $A_0=\frac{R_1+R_2}{R_2}$

\subsection{Exemple}


\begin{exemple}
On souhaite amplifier un signal sinusoïdal par un coefficient $k=5$.\\
On peut donc utiliser le montage précédent. \\
On prendra $R_1=1 k\Omega$ et $R_2=4k\Omega$ pour avoir $A_0=5$
\img{\rootImages/inv_img.png}{Amplification du signal noir par 5}{0.4}
\end{exemple}


\chapter{Montage inverseur}
\section{Présentation}

Ce montage amplifie la tension $V_e$ par un \bold{gain $A_0$ négatif}.

\section{Montage}

\img{Images/aop/non_inv.png}{Le montage amplificateur non inverseur}{0.8}

\section{Démonstration}

Mode linéaire : $\varepsilon = 0$
\begin{align}
E_+&=0 \\
E_-&= \frac{ \frac{V_e}{R_1}+\frac{V_s}{R_2} } { \frac{1}{R_1} + \frac{1}{R_2}} \\
E_-&=\frac{V_e \cdot R_2 + V_s \cdot R_1}{R_1 + R_2} \\
\Rightarrow \frac{V_e}{V_s} &= -\frac{R_1}{R_2}\\
\Rightarrow V_s &= -V_e \cdot \frac{R_2}{R_1} 
\end{align}

Avec $A0= -\frac{R_2}{R1}$

\section{Application}

\begin{exemple}
On souhaite amplifier un signal sinusoïdal par un coefficient $k=-5$.\\
On peut donc utiliser le montage précédent. \\
On prendra $R_1=1 k\Omega$ et $R_2=5k\Omega$ pour avoir $A_0=-5$
\img{Images/aop/inv_signal.png}{Amplification du signal noir par -5}{0.4}

\end{exemple}

\chapter{Montages comparateurs}
\section{Présentation}

Un montage comparateur se reconnaît par son branchement : 

\begin{itemize}
  \item {\color{red}Aucune contre réaction} n’est présente
  \item Une {\color{red} contre réaction a lieu sur l’entrée non inverseuse} via un dipôle passif
\end{itemize}

Le montage comparateur permet de comparer deux tensions entre elles. \\
Cependant, cette comparaison peut s’effectuer de plusieurs manières, avec un ou deux seuils, de manière inversée ou non...

\subsection{Comparateur non inverseur simple seuil}

\subsubsection{Présentation}

Ce montage permet de comparer simplement deux tensions entre elle.

\subsubsection{Montage}

\img{Images/aop/cmp.png}{Comparateur simple seuil}{0.7}

Ce mode est le plus simple et est régi de la manière suivante : \\

On sait que $\varepsilon = E_+ - E_-$ et que $V_s=\varepsilon \cdot A_d$ avec $Ad=+\infty$ \\
(Circuit en boucle ouverte) \\


Si $E_+>E_-$ :
$$Vs=Vsat_+$$ 
 si $E_+<E_-$ :
$$Vs=Vsat_-$$

Si $V_2=0V$, on obtient la caractéristique de transfert suivante  

\img{Images/aop/12.jpg}{Caractéristique de transfert, $V_1$ est la tension d’entrée de l’AOP}{0.3}


\subsection{Comparateur inverseur simple seuil}

Le raisonnement est le même sauf que les entrées sont inversées. \\
De ce fait, le seuil de basculement se fait dans l’autre sens. \\

Si $E_+>E_-$ :
$$Vs=Vsat-$$
Si $E_+<E_-$ :
$$V_s=Vsat_+$$

\subsection{Comparateur non inverseur double seuil}


\subsubsection{Présentation}

Ce type de montage permet d’éliminer les tensions “parasites”, c’est à dire les tensions bruités et non indésirables. \\

\subsubsection{Montage}

\img{Images/aop/double_cmp.png}{Montage comparateur non inverseur double seuil }{0.8}

\subsubsection{Application}

Par exemple, un capteur de lumière résistif (photo-résistance) sera sensible aux variations de lumière (nuages…). \\

\img{Images/aop/14.png}{Un signal bruité}{0.5}

Or, si on compare ce signal par rapport à une référence, on ne veut pas que le capteur déclenche plusieurs fois l’action.

\img{Images/aop/trig.png}{Le cycle de déclenchement}{1}

Pour éviter ce problème, on utilise un comparateur à double seuil : \\
toute les tensions parasites ayant une amplitude inférieure à la tension de différence entre les deux seuils seront ignorées.\\

\img{Images/aop/dual.png}{Le principe}{0.8}

On va chercher les deux valeurs de basculement : 

$$E_+ = \frac{V_eR_2 + V_s R_1}{R_1 + R_2}$$
$$E_- = U_0=0$$

Étudions le cas où $\varepsilon>0$

\begin{align}
\varepsilon>0 & \Leftrightarrow E_+ > E_-\\
& \Leftrightarrow \frac{V_eR_2 + V_s R_1}{R_1 + R_2} > U_0 \\
& \Leftrightarrow \frac{V_eR_2}{R_1 + R_2} > U_0 -  \frac{V_s R_1 }{R_1 + R_2} \\
& \Leftrightarrow  V_eR_2 > R_1 + R_2 \cdot  U_0 -  V_s R_1 \\
& \Leftrightarrow  V_e > \frac{R_1 + R_2 \cdot  U_0 -  V_s R_1}{R_2}
\end{align}

Ici, $U_0=0$ et $V_s=V_{sat_+}$ car $\varepsilon>0$

D'où $V_e > \frac{-V_{sat} + R_1}{R_2}$


\messageBox{Remarque}{orange}{white}{$U_0$ peut être différent de $0V$ en mettant une source de tension sur $E_-$}{black}


Étudions le cas où $\varepsilon>0$ : 

\begin{align}
\varepsilon>0 & \Leftrightarrow E_+ < E_-\\
& \Leftrightarrow \frac{V_eR_2 + V_s R_1}{R_1 + R_2} < U_0 \\
& \Leftrightarrow  \frac{V_eR_2}{R_1 + R_2} < U_0 -  \frac{V_s R_1 }{R_1 + R_2} \\
& \Leftrightarrow  V_eR_2 < R_1 + R_2 \cdot  U_0 -  V_s R_1 \\
& \Leftrightarrow  V_e < \frac{R_1 + R_2 \cdot  U_0 -  V_s R_1}{R_2}
\end{align}

Ici, $U_0=0$ et $V_s=V_{sat_-}$ car $\varepsilon<0$ \\

D'où $V_e < \frac{-V_{sat} + R_1}{R_2}$



On obtient deux seuils $S1$ et $S2$ de valeurs respectives : \\


$\frac{-V_{sat}+R1}{R2}$ et $\frac{Vsat - R_1}{R_2}$ \\



Afin de basculer, la tension d’entrée doit dépasser $S1 V$ et afin de basculer dans l’autre sens, la tension d’entrée doit être inférieure à $S2 V$ \\


On obtient le cycle d’hystérésis suivant : \\

$(VB=S2 et VH=S1)$

\img{Images/aop/hys1.png}{Cycle d'hystérésis non inverseur}{0.8}



$U_{milieu\_de\_cycle}=(V_{seuil1}+V_{seuil2}) \cdot 0.5$ \\
$Largeur_{cycle}=V_{seuil1}-V_{seuil2}$



\subsection{Comparateur inverseur double seuil}

\subsubsection{Montage}

\img{Images/aop/double_inv.png}{Montage comparateur inverseur double seuil}{0.5} %dede

\subsubsection{Démonstration}

La démarche est rigoureusement identique avec $\varepsilon>0$, on a $V_s=Vsat_+$
et pour  $\varepsilon<0$ on a $V_s=Vsat_-$

On obtient le cycle d’hystérésis suivant : \\


\img{Images/aop/hys2.png}{Cycle d'hystérésis inverseur}{0.8}



\chapter{Montage intégrateur}
\section{Présentation}
Ce montage intègre une tension d’entrée. \\
En sortie, on obtient une tension $V_s$ valant $V_s=k \cdot \int V_e$

\section{Montage}

\img{Images/aop/integrateur.png}{Montage intégrateur}{0.6}

\section{Démonstration}

Montage en mode linéaire car contre-réaction négative. \\


\begin{align}
I_{R1} + I_{C1}  = 0 & 
& \Leftrightarrow I_{R1} = -I_{C1} \\
& \Leftrightarrow \frac{E}{R} = - C \cdot \frac{dV_s}{dt} \\
& \Leftrightarrow -\frac{1}{RC}\cdot E = \frac{dV_s}{dt} \\
& \Leftrightarrow V_s = -\frac{1}{RC} \int V_e \\
k=-\frac{1}{RC} &
\end{align}
   
Ce montage est notamment présent dans certains Convertisseurs Analogiques Numériques dit “simple” ou “double” rampe. 


\section{Application}

\begin{exemple}
On souhaite générer un signal triangulaire.
\end{exemple}


En intégrant un signal rectangulaire, on obtient un signal triangulaire.


\img{Images/aop/triangle.png}{Un signal triangulaire généré depuis un signal carré}{0.4}

Soit $V_e=2V$ ou $V_e=-2V$

Si $V_e=2V$ \\

\begin{align}
k \int V_e &= k V_e\cdot t + x\\
&= - \frac{2}{RC}t+c 
\end{align}

avec $k=-\frac{1}{RC} $ \\

$\Rightarrow$ droite d'équation $y=-\frac{2}{RC}+c$ \\


Si $V_e=-2V$ \\

\begin{align}
k \int V_e &= k V_e\cdot t + x \\
&= \frac{2}{RC}t+c 
\end{align}

avec $k=-\frac{1}{RC} $ \\

$\Rightarrow$ droite d'équation $y=\frac{2}{RC}+c$

\chapter{Montage soustracteur}
\section{Présentation}
Ce montage permet de soustraire deux tensions d’entrée afin d’obtenir la différence en sortie.

\section{Montage}

\img{Images/aop/sous.png}{Montage soustracteur}{0.6}

\section{Démonstration}


Contre-réaction négative donc mode linéaire.\\


$$E_+=U_2\frac{R_4}{R_2+R_4}$$

\begin{align}
E_-&=\frac{\frac{U_1}{R_1}+\frac{U_5}{R3}}{\frac{1}{R_1}+\frac{1}{R_3}}\\
&=\frac{U_1R_3+U_5R_1}{R_1+R_3}
\end{align}

Or $E_+=E_-$

\begin{align}
&\Leftrightarrow U_2 \cdot \frac{R_4}{R_2+R_4} = \frac{U_1R_3+U_5R_1}{R_1+R_3} \\
&\Leftrightarrow  \frac{U_5R_1}{R_1+R_3} = \frac{U_2R_4}{R_2+R_4} -\frac{U_1R_3}{R_1+R_3} \\
&\Leftrightarrow  U_5R_1 = \frac{R_4(R_1+R_3)}{R_2+R_4} - \frac{U_1R_3}{R_1} 
\end{align}


Si $R_1=R_2=R_3=R_4$, on obtient : \\

$U_s=U_2-U_1$\\

\section{Application}

\begin{exemple}
On souhaite mesurer une tension entre deux points A et B d’un circuit (tension différentielle)
\img{Images/aop/variable.png}{Tension différentielle $AB$}{0.4}
\end{exemple}


Pour étudier la différence de potentiel entre les deux points du circuit, on peut utiliser un montage soustracteur afin qu’en sortie du montage avec l’AOP, on ait : $$V_s=V_a-V_b$$

On peut réaliser le montage suivant.

\img{Images/aop/diff.png}{Un montage pour lire une tension entre deux points}{0.55}\chapter{Montage sommateur}

\section{Présentation}
Ce montage permet d'additionner en sortie plusieurs tensions d’entrée. Avec ce montage, la tension de sortie est multipliée par un coefficient -1

\section{Montage}
\img{Images/aop/somme.png}{Montage sommateur inverseur}{0.6}

\section{Démonstration}

Contre-réaction négative donc montage linéaire. \\
On applique le théorème de Millman \footnote{on fera abstraction de U3}

$$E_+=0$$
$$ E_- = \frac{ \frac{U_1}{R_1} + \frac{U_2}{R_1} + \frac{U_s}{R_1} }{\frac{1}{R_1} + \frac{1}{R_1} + \frac{1}{R_1}}=0$$

\begin{align}
&\Leftrightarrow \frac{U_1+U_2+U_s}{R_1}=0 \\
&\Leftrightarrow \frac{U_s}{R_1} = \frac{-(U_1+U_2)}{R_1} \\
&\Leftrightarrow U_s = -(U_1+U_2)
\end{align}

\end{document}
%#############################################################
